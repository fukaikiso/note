# HTML5

## 1 WebStorage

`HTML5`提供的一套客户端持久化数据存储的方案，包含两大存储区域：

`localStorage`：将数据存储到`localStorage`中后，将会永久保存。

`sessionStorage`：将数据存储到`sessionStorage`中后，仅对当前浏览器会话生效，（浏览器关闭，`sessionStorage`中的数据将会清空）

**如何存**

```javascript
window.localStorage.setItem(key, value)
window.sessionStorage.setItem(key, value)

localStorage.setItem(key, value)
sessionStorage.setItem(key, value)
```

**如何取**

```
let val = localStorage.getItem(key)
```

**如何删**

```javascript
localStorage.removeItem(key)
sessionStorage.removeItem(key)
```



## 2 网页中的音频与视频

`HTML5`标准中提供了两个标签分别用于播放音频（`<audio>`）与视频（`<video>`）。

### 音频

使用`<audio>`来播放音频文件，支持的音频格式有：`mp3/wav/ogg`... 基本使用方法如下：

```html
<audio controls src="音频路径">
</audio>
```

案例：`01_audio.html`。

**常用属性：**

```html
<audio controls        是否显示控制面板
       src="音频路径"    
       autoplay        是否自动播放
       muted           是否静音
       loop            是否单曲循环
       preload="音频源预加载模式：auto|metadata|none"        
     >
</audio>
```

preload:

​	none: 不进行音频预加载

​	metadata：仅仅加载音频基本信息

​	auto：尽可能多的加载音频数据



### 视频

`HTML5`提供了视频标签实现在网页中播放视频，支持的格式：`mp4/webm/ogg`...

```html
<video controls src="视频路径"></video>
```

**常用属性：**

```html
<video controls        是否显示控制面板
       src="音频路径"    
       autoplay        是否自动播放
       muted           是否静音
       loop            是否单曲循环
       preload="音频源预加载模式：auto|metadata|none"        
       width="播放器的宽度"
       height="播放器的高度"
       poster="海报帧，表示视频未播放时的图片路径"
     >
</video>
```



#### 音视频的DOM相关操作

```html
<audio id="audio" src="./xxx.mp3"></audio>
```

```javascript
let audio = document.getElementById('audio')
// 调用方法
audio.play()
audio.pause()
// 访问属性
audio.duration
audio.volume
// 绑定事件
audio.addEventListener('play', function(){ 事件处理业务逻辑 })
```

网易云音乐接口文档：

https://neteasecloudmusicapi.vercel.app/#/



## 3 Canvas

`Canvas`用于使用`Javascript`在网页中绘制图形图像。常用于：

1. 网页特效。
2. 图表。
3. 网页游戏。

### 3.1 Canvas的基本使用

基于`Canvas`绘制图像的基本写法如下：

```html
<canvas id="cvs" width="640" height="360"></canvas>
```

`width`与`height`两个属性定义了`canvas`图像的分辨率。

```javascript
let cvs = document.getElementById('cvs')
// 获取canvas元素绘制2d图形所需要的Context对象  (上下文对象)
let ctx = cvs.getContext('2d')
```

案例：`canvas.html`



### 3.2 Canvas基本绘图API

**填充矩形：**

```javascript
let cvs = document.getElementById('cvs')
let ctx = cvs.getContext('2d')  // 获取绘制canvas的Context对象
// 开始绘制
ctx.fillStyle = 'red'   // 设置填充颜色
ctx.fillRect(100, 50, 150, 100)  // 填充一个矩形（左上x，左上y，宽，高）
```

**描边矩形：**

```javascript
ctx.strokeStyle = "blue"
ctx.strokeRect(50, 100, 200, 200)
```

**绘制文本：**

```javascript
ctx.font = '20px  微软雅黑'
ctx.fillText('文本内容', x, y)
```

基础绘图相关API文档：

https://www.w3school.com.cn/tags/html_ref_canvas.asp



### 3.3 Canvas 绘制路径

什么叫路径？

路径是由一系列的点按照顺序连接起来所形成的的图形。通过`js`绘制路径的流程如下：

> 1. 调用`ctx.beginPath()`开启一条路径。 
> 2. 调用`ctx.moveTo(x, y)`将画笔移动到某一个坐标位置。
> 3. 调用绘制路径相关方法（例如：`ctx.lineTo(x, y)`） 绘制路径。
> 4. 路径绘制结束后，调用`ctx.stroke()`方法将路径描边。或调用`ctx.fill()`方法将路径填充。

案例： 绘制五角星。  `03_path.html`。



#### 案例： 绘制移动端手写板。

移动端手指触摸相关事件：

> 1. `ontouchstart`:  触摸开始事件
> 2. `ontouchmove`:   触摸移动时触发
> 3. `ontouchcancel`:  触摸操作被打断时触发
> 4. `ontouchend`: 触摸结束时触发

**`HTML5`的`canvas`提供了相关`API`方法用于绘制常见路径：**

绘制矩形路径：

```javascript
ctx.rect(x, y, width, height)
ctx.fill()
ctx.stroke()
```

绘制圆弧路径：

```
ctx.arc(x, y, r, startAngle, endAngle)
```

案例：测试`API`。

```javascript
let ctx = canvas.getContext('2d')
// 绘制矩形路径
ctx.rect(50, 50, 200, 150)
ctx.fillStyle = '#9116a1'
ctx.fill()
ctx.stroke()
// 绘制圆弧路径
ctx.beginPath()  // 重新开启新路径
ctx.arc(400, 150, 100, 0, Math.PI/2)
ctx.lineTo(400, 150)
ctx.closePath()  // 闭合路径 将结束点与起始点连接
ctx.fill()
// 绘制圆弧路径
ctx.beginPath()
ctx.arc(395, 145, 105, Math.PI/2, 2*Math.PI)
ctx.lineTo(395, 145)
ctx.closePath()
ctx.fillStyle = "#a59"
ctx.fill()
```

#### `Canvas`动画

动画的本质：每隔一段时间，不间断的重绘`UI`界面，由于每一帧绘制比上一帧绘制有些许变化，而间隔时间太短，人眼视觉残留现象出现动画效果。

```javascript
window.setInterval(()=>{
    修改绘制属性
    重画UI
}, 1000/60)
```

案例：实现弹幕效果。

1. 准备一个`Canvas`，覆盖在`video`标签之上。
2. 准备一个输入框和按钮，点击按钮发送弹幕。
3. 在canvas中以平移动画的方式显示弹幕效果。



**动画卡顿的本质原因：掉帧。**

掉帧的原因是使用`window.setInterval()`实现了动画。定时器无法保证每秒`60`帧。

若希望绘制不卡顿的动画，推荐使用：`window.requestAnimationFrame( callback )`:该方法的作用是：一旦调用该方法，当浏览器刷新下一帧时，将会自动执行callback回调方法进行动画属性的修改。这样下一帧绘制时就可以保证属性已经被更新，避免卡顿。

常见写法：

```
draw(){
	稍微耗时的操作，for之类的
	重新绘制UI
	window.requestAnimationFrame(draw)
}
draw()
```



### 3.4 地理定位

`HTML5`提供了地理定位相关`API`使得网页可以通过`javascript`获取当前设备的地理位置.

#### 定位基础

1. `IP`定位     客户端发送请求时必然会携带`IP`地址，服务端就可以根据客户端的`IP`地址获取位置信息。（不准）
2. 基站定位   运营商基站与手机芯片进行交互，从而判断相对位置。
3. `GPS`卫星定位     精准度非常高。



#### `HTML5`提供的`API`实现获取客户端的经纬度位置信息

```javascript
let geoloc = window.navigator.geolocation
geoloc.getCurrentPosition((res)=>{
    
}, (err)=>{
    
}, {timeout: 5000})
```

案例：`03_loc.html`。

```
coords: Coordinates
    accuracy: 19218     精准度
    altitude: 0         海拔高度
    altitudeAccuracy: null    海拔精准度
    heading: NaN    
    latitude: 39.9078      纬度
    longitude: 116.3975    经度
    speed: NaN      速度
timestamp: 1657532026370
```

高德地图开放平台提供了一些小工具，可以查看经纬度的地图位置：

1. https://lbs.amap.com/
2. 开发支持
3. 地图工具 - 坐标拾取器
4. 选择按坐标搜索：输入格式：  经度,纬度

由于机器设备问题（无`GPS`，无`SIM`卡），`google`浏览器将会访问`google`查询`IP`位置，由于国家政策，访问不到，可以使用`google`的虚拟定位模拟器来测试定位`API`。

**开启虚拟定位模拟器：**

1. f12打开控制台。
2. 点击ESC退出键，将会出现操作栏。
3. 点击三个点，选择sensors。

4. 选择一个位置即可。（注意：不要关闭该控制台。）



#### 第三方地图服务   百度地图 - 高德地图 - 腾讯地图









